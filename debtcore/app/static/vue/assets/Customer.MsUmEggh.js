import{_ as Ce,a as ke,b as Se,c as Ie,d as Pe,e as fe,u as H,f as Re,g as Ue,h as Fe,i as ue,j as X,k as Te,l as je,m as De,n as Me,o as ze,p as Ne,q as Ae,r as Be,F as me,z as A,s as pe}from"./Checkbox.vue_vue_type_script_setup_true_lang.0dpU0WqK.js";import{e as j,r as B,o as d,c as v,d as i,t as R,a as e,k as t,u as a,F as M,v as z,s as k,b as m,x as Z,l as _,y as _e,z as ge,A as he,B as Q,E,i as I,I as ee,K as ae,H as N,W as be,X as ye,a3 as ve,_ as $,R as te,N as se,Q as le,a4 as ne,a5 as oe,a6 as ie,a7 as re,a8 as K,Y as O,m as W,Z as we,a9 as de,n as q,C as Ee,D as J,T as Y,g as We,a0 as F,aa as He,G as xe,a1 as Ge,a2 as Le}from"../main.js";import{_ as Ke,a as qe}from"./DropdownMenuLabel.vue_vue_type_script_setup_true_lang.H-PZVEjJ.js";import{_ as $e}from"./DialogScrollContent.vue_vue_type_script_setup_true_lang.G3qJvuAl.js";import{_ as Ve}from"./DialogFooter.vue_vue_type_script_setup_true_lang.CUbi7heN.js";import{_ as C}from"./Input.vue_vue_type_script_setup_true_lang.-kCyUBhQ.js";import{_ as ce}from"./lodash.BtnTHUG3.js";import{_ as Qe}from"./index.DhdF1qMN.js";import{c as Je}from"./connection.BGxe5Pwg.js";const Oe={class:"flex flex-col md:flex-row items-center justify-between px-2 pb-10"},Xe={class:"flex-1 text-sm text-muted-foreground mb-4 md:mb-0"},Ye={class:"flex items-center space-x-6 lg:space-x-8 text-primary"},Ze={class:"flex items-center space-x-2"},ea=i("p",{class:"text-sm font-medium"},"Rows per page",-1),aa={class:"flex w-[100px] items-center justify-center text-sm font-medium"},ta={class:"flex items-center space-x-2"},sa=i("span",{class:"sr-only"},"Go to first page",-1),la=i("span",{class:"sr-only"},"Go to previous page",-1),na=i("span",{class:"sr-only"},"Go to next page",-1),oa=i("span",{class:"sr-only"},"Go to last page",-1),ia=j({__name:"DataTablePagination",props:{table:{}},setup(c){return(n,l)=>{const s=B("VIcon");return d(),v("div",Oe,[i("div",Xe,R(n.table.getFilteredSelectedRowModel().rows.length)+" of "+R(n.table.getFilteredRowModel().rows.length)+" row(s) selected. ",1),i("div",Ye,[i("div",Ze,[ea,e(a(Ie),{"model-value":`${n.table.getState().pagination.pageSize}`,"onUpdate:modelValue":n.table.setPageSize},{default:t(()=>[e(a(Ce),{class:"h-8 w-[70px]"},{default:t(()=>[e(a(ke),{placeholder:`${n.table.getState().pagination.pageSize}`},null,8,["placeholder"])]),_:1}),e(a(Se),{side:"top"},{default:t(()=>[(d(),v(M,null,z([10,20,30,40,50],r=>e(a(Pe),{key:r,value:`${r}`},{default:t(()=>[m(R(r),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])]),i("div",aa," Page "+R(n.table.getState().pagination.pageIndex+1)+" of "+R(n.table.getPageCount()),1),i("div",ta,[e(a(k),{variant:"outline",class:"hidden h-8 w-8 p-0 lg:flex",disabled:!n.table.getCanPreviousPage(),onClick:l[0]||(l[0]=r=>n.table.setPageIndex(0))},{default:t(()=>[sa,e(s,{name:"fa-arrow-left",class:"h-4 w-4"})]),_:1},8,["disabled"]),e(a(k),{variant:"outline",class:"h-8 w-8 p-0",disabled:!n.table.getCanPreviousPage(),onClick:l[1]||(l[1]=r=>n.table.previousPage())},{default:t(()=>[la,e(s,{name:"fa-chevron-left",class:"h-4 w-4"})]),_:1},8,["disabled"]),e(a(k),{variant:"outline",class:"h-8 w-8 p-0",disabled:!n.table.getCanNextPage(),onClick:l[2]||(l[2]=r=>n.table.nextPage())},{default:t(()=>[na,e(s,{name:"fa-chevron-right",class:"h-4 w-4"})]),_:1},8,["disabled"]),e(a(k),{variant:"outline",class:"hidden h-8 w-8 p-0 lg:flex",disabled:!n.table.getCanNextPage(),onClick:l[3]||(l[3]=r=>n.table.setPageIndex(n.table.getPageCount()-1))},{default:t(()=>[oa,e(s,{name:"fa-arrow-right",class:"h-4 w-4"})]),_:1},8,["disabled"])])])])}}}),ra=j({__name:"DataTableViewOptions",props:{table:{}},setup(c){const n=c,l=Z(()=>n.table.getAllColumns().filter(s=>typeof s.accessorFn<"u"&&s.getCanHide()));return(s,r)=>(d(),_(a(he),null,{default:t(()=>[e(a(_e),{"as-child":""},{default:t(()=>[e(a(k),{variant:"outline",size:"sm",class:"ml-auto hidden h-8 lg:flex"},{default:t(()=>[m(" View ")]),_:1})]),_:1}),e(a(ge),{align:"end",class:"w-[150px]"},{default:t(()=>[e(a(Ke),null,{default:t(()=>[m("Toggle columns")]),_:1}),e(a(fe)),(d(!0),v(M,null,z(l.value,p=>(d(),_(a(qe),{key:p.id,class:"capitalize",checked:p.getIsVisible(),"onUpdate:checked":g=>p.toggleVisibility(!!g)},{default:t(()=>{var g;return[m(R(((g=p.columnDef.meta)==null?void 0:g.title)||p.id),1)]}),_:2},1032,["checked","onUpdate:checked"]))),128))]),_:1})]),_:1}))}}),da={class:"grid gap-4 py-4"},ca={class:"grid grid-cols-4 items-center gap-4"},ua=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),ma={class:"grid grid-cols-4 items-center gap-4"},pa=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),fa={class:"grid grid-cols-4 items-center gap-4"},_a=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),ga={class:"col-span-3"},ha={class:"grid grid-cols-4 items-center gap-4"},ba={class:"grid grid-cols-4 items-center gap-4"},ya={class:"grid grid-cols-4 items-center gap-4"},va={class:"grid grid-cols-4 items-center gap-4"},wa={class:"grid grid-cols-4 items-center gap-4"},xa={class:"grid grid-cols-4 items-center gap-4"},$a={key:0,class:"grid grid-cols-4 items-center gap-4"},Va=j({__name:"DataTableCreateCustomer",setup(c){const n=Q("tableStore",H("customer")),l=E({name:"",business_registration_id:"",whatsapp_phone_number:"",email:"",streetAddress:"",postcode:"",city:"",state:"",country:null}),s=E({is_loading:!1,is_open:!1,data:[{value:"",label:""}]}),r=I("");async function p(x){s.is_loading=!0;try{const u=await N.get(`/api/country/list?search=${x||""}`,{withCredentials:!0,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}});s.data=u.data.Result}catch{V({title:"Whoops, something went wrong",description:"There was an error fetching the country list",variant:"destructive"})}finally{s.is_loading=!1}}const g=I(!1),P=I(!1),T=I(null),{toast:V}=ee();ae(r,ce.debounce(async x=>{P.value&&await p(x)},500));function w(){const x=[{condition:l.name==="",message:"Name cannot be blank"},{condition:l.whatsapp_phone_number==="",message:"Whatsapp Phone cannot be blank"},{condition:l.country==null,message:"Country cannot be blank"}];for(let u of x)if(u.condition)return T.value=u.message,!1;return!0}async function D(){var o;if(!w())return;g.value=!0;const u=JSON.parse(((o=document.getElementById("drf_csrf"))==null?void 0:o.textContent)||"{}");try{const S=await N.post("/api/customer",{...l},{headers:{"Content-Type":"application/json",[u.csrfHeaderName]:u.csrfToken}});U(),await n.refresh(n.page_index),V({title:S.data.Result,variant:"success"})}catch(S){var b=S.response.data.message||"";V({title:"Whoops, something went wrong",description:b,variant:"destructive"})}finally{g.value=!1}}function U(){P.value=!P.value,P.value&&p(r.value)}function h(x){l.country=x.id,s.is_open=!1}function y(x){r.value=x.target.value}return(x,u)=>{const b=B("VIcon");return d(),v("div",null,[i("div",null,[e(a(k),{variant:"default",size:"sm",class:"h-8 ml-2 flex",onClick:U},{default:t(()=>[e(b,{name:"fa-plus",class:"size-4"})]),_:1})]),e(a(we),{open:P.value,"onUpdate:open":u[10]||(u[10]=o=>P.value=o)},{default:t(()=>[e(a($e),{isSideBar:!1,class:"sm:max-w-[700px]"},{default:t(()=>[e(a(be),null,{default:t(()=>[e(a(ye),null,{default:t(()=>[m("Create Custsomer")]),_:1}),e(a(ve),null,{default:t(()=>[m(" Insert the details of the customer here. Click create when you're done. ")]),_:1})]),_:1}),i("div",da,[i("div",ca,[e(a($),{for:"name",class:"text-right"},{default:t(()=>[m(" Company Name "),ua]),_:1}),e(a(C),{id:"name",modelValue:l.name,"onUpdate:modelValue":u[0]||(u[0]=o=>l.name=o),placeholder:"Geroge Sdn Bhd",class:"col-span-3"},null,8,["modelValue"])]),i("div",ma,[e(a($),{for:"whatsapp_phone",class:"text-right required:"},{default:t(()=>[m(" Whatsapp Phone "),pa]),_:1}),e(a(C),{id:"whatsapp_phone",modelValue:l.whatsapp_phone_number,"onUpdate:modelValue":u[1]||(u[1]=o=>l.whatsapp_phone_number=o),placeholder:"0129876348",class:"col-span-3"},null,8,["modelValue"])]),i("div",fa,[e(a($),{for:"country",class:"text-right leading-normal"},{default:t(()=>[m(" Country "),_a]),_:1}),i("div",ga,[e(a(te),{open:s.is_open,"onUpdate:open":u[3]||(u[3]=o=>s.is_open=o)},{default:t(()=>[e(a(se),{"as-child":""},{default:t(()=>[e(a(k),{variant:"outline",role:"combobox","aria-expanded":s.is_open,class:"w-full justify-between px-3",disabled:s.is_loading},{default:t(()=>{var o;return[m(R(l.country?(o=s.data.find(S=>S.id===l.country))==null?void 0:o.label:"Select country")+" ",1),s.is_loading?(d(),_(b,{key:0,name:"fa-circle-notch",animation:"spin",class:"w-4 h-4 mr-2"})):(d(),_(b,{key:1,name:"fa-angle-down",class:"h-4 w-4 shrink-0 opacity-50"}))]}),_:1},8,["aria-expanded","disabled"])]),_:1}),e(a(le),{class:"w-[500px] p-1"},{default:t(()=>[e(a(ne),null,{default:t(()=>[e(a(oe),{class:"h-9",modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=o=>r.value=o),placeholder:"Search country...",onInput:y},null,8,["modelValue"]),e(a(ie),null,{default:t(()=>[m("No country found.")]),_:1}),s.is_loading?(d(),_(a(K),{key:1},{default:t(()=>[(d(),_(b,{key:0,name:"fa-circle-notch",animation:"spin",speed:"slow",class:"w-fit h-fit mr-2 my-2 mx-auto"}))]),_:1})):(d(),_(a(K),{key:0},{default:t(()=>[e(a(re),null,{default:t(()=>[(d(!0),v(M,null,z(s.data,o=>(d(),_(a(de),{key:o.id,value:o.value??"",onSelect:()=>h(o)},{default:t(()=>[m(R(o.label)+" ",1),e(b,{name:"fa-check",class:q(["ml-auto h-4 w-4",l.country===o.id?"opacity-100":"opacity-0"])},null,8,["class"])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["open"])])]),i("div",ha,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Email ")]),_:1}),e(a(C),{id:"email",modelValue:l.email,"onUpdate:modelValue":u[4]||(u[4]=o=>l.email=o),placeholder:"hello@example.com",class:"col-span-3"},null,8,["modelValue"])]),i("div",ba,[e(a($),{for:"business_registration_id",class:"text-right"},{default:t(()=>[m(" Business ID ")]),_:1}),e(a(C),{id:"business_registration_id",modelValue:l.business_registration_id,"onUpdate:modelValue":u[5]||(u[5]=o=>l.business_registration_id=o),placeholder:"820720-X",class:"col-span-3"},null,8,["modelValue"])]),e(O),i("div",ya,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Address ")]),_:1}),e(a(C),{id:"email",modelValue:l.streetAddress,"onUpdate:modelValue":u[6]||(u[6]=o=>l.streetAddress=o),placeholder:"Lot 2000, Taman Jalan Indah",class:"col-span-3"},null,8,["modelValue"])]),i("div",va,[e(a($),{for:"state",class:"text-right leading-normal"},{default:t(()=>[m(" State ")]),_:1}),e(a(C),{id:"state",modelValue:l.state,"onUpdate:modelValue":u[7]||(u[7]=o=>l.state=o),placeholder:"Selangor",class:"col-span-3"},null,8,["modelValue"])]),i("div",wa,[e(a($),{for:"city",class:"text-right leading-normal"},{default:t(()=>[m(" City ")]),_:1}),e(a(C),{id:"city",modelValue:l.city,"onUpdate:modelValue":u[8]||(u[8]=o=>l.city=o),placeholder:"Puchong",class:"col-span-3"},null,8,["modelValue"])]),i("div",xa,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Post Code ")]),_:1}),e(a(C),{id:"email",modelValue:l.postcode,"onUpdate:modelValue":u[9]||(u[9]=o=>l.postcode=o),placeholder:"22000",class:"col-span-3"},null,8,["modelValue"])]),e(O)]),T.value?(d(),v("div",$a,[e(a($),{for:"name",class:"text-red-600 col-span-3 col-start-2"},{default:t(()=>[e(b,{name:"fa-exclamation-triangle",class:"size-4 fill-red-600"}),m(" "+R(T.value),1)]),_:1})])):W("",!0),e(a(Ve),{class:"flex justify-end"},{default:t(()=>[e(a(k),{type:"submit",onClick:D,disabled:g.value},{default:t(()=>[g.value?(d(),_(b,{key:0,name:"fa-circle-notch",animation:"spin",speed:"slow",class:"w-fit h-fit mr-2"})):W("",!0),m(" Create")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Ca=j({__name:"DataTableRefreshButton",setup(c){const n=Q("tableStore",H("customer")),l=()=>{n.refresh(n.page_index)};return(s,r)=>{const p=B("VIcon");return d(),v("div",null,[e(a(k),{variant:"outline",size:"default",class:"flex h-8 ml-2",onClick:l},{default:t(()=>[e(p,{name:"md-refresh",class:"size-4"})]),_:1})])}}}),ka={class:"flex items-center justify-between"},Sa={class:"flex flex-1 items-center space-x-2"},Ia=j({__name:"DataTableToolbar",props:{table:{}},setup(c){const n=c,l=Z(()=>n.table.getState().columnFilters.length>0);return(s,r)=>{var p;return d(),v("div",ka,[i("div",Sa,[e(a(C),{placeholder:"Search...","model-value":((p=s.table.getColumn("name"))==null?void 0:p.getFilterValue())??"",class:"h-8 w-[150px] lg:w-[250px]",onInput:r[0]||(r[0]=g=>s.table.setGlobalFilter(g.target.value))},null,8,["model-value"]),l.value?(d(),_(a(k),{key:0,variant:"ghost",class:"h-8 px-2 lg:px-3",onClick:r[1]||(r[1]=g=>s.table.resetColumnFilters())},{default:t(()=>[m(" Reset ")]),_:1})):W("",!0)]),e(ra,{table:s.table},null,8,["table"]),e(Ca),e(Va)])}}}),Pa={class:"space-y-4 text-muted-foreground"},Ra={key:0,class:"text-center"},Ua={key:1,class:"rounded-md border"},Fa=j({__name:"DataTable",props:{columns:{},data:{}},setup(c){const n=Q("tableStore",H("customer")),l=c,s=I([]),r=I([]),p=I({}),g=I({pageIndex:n.page_index,pageSize:n.page_size}),P=I();function T(w,D){let U;typeof w=="function"?U=w(D.value):U=w,D.value=U,n.set_page_index(U.pageIndex),n.set_page_size(U.pageSize)}const V=Re({get data(){return l.data},get columns(){return l.columns},state:{get sorting(){return s.value},get columnFilters(){return r.value},get columnVisibility(){return p.value},get rowSelection(){return P.value},get pagination(){return g.value}},enableRowSelection:!0,onSortingChange:w=>J(w,s),onPaginationChange:w=>T(w,g),onColumnFiltersChange:w=>J(w,r),onColumnVisibilityChange:w=>J(w,p),onRowSelectionChange:w=>J(w,P),getCoreRowModel:je(),getFilteredRowModel:De(),getPaginationRowModel:Me(),getSortedRowModel:ze(),getFacetedRowModel:Ne(),getFacetedUniqueValues:Ae()});return Ee(()=>{V.setPageIndex(n.page_index),V.setPageSize(n.page_size)}),(w,D)=>{const U=B("VIcon");return d(),v("div",Pa,[e(Ia,{table:a(V)},null,8,["table"]),a(n).is_loading?(d(),v("div",Ra,[e(U,{name:"fa-circle-notch",animation:"spin",speed:"slow",class:"w-10 h-10"})])):(d(),v("div",Ua,[e(a(Te),null,{default:t(()=>[e(a(Ue),null,{default:t(()=>[(d(!0),v(M,null,z(a(V).getHeaderGroups(),h=>(d(),_(a(X),{key:h.id},{default:t(()=>[(d(!0),v(M,null,z(h.headers,y=>(d(),_(a(Be),{key:y.id},{default:t(()=>[y.isPlaceholder?W("",!0):(d(),_(a(me),{key:0,render:y.column.columnDef.header,props:y.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),e(a(Fe),{id:"dbTableBody"},{default:t(()=>{var h;return[(h=a(V).getRowModel().rows)!=null&&h.length?(d(!0),v(M,{key:0},z(a(V).getRowModel().rows,y=>(d(),_(a(X),{key:y.id,"data-state":y.getIsSelected()&&"selected"},{default:t(()=>[(d(!0),v(M,null,z(y.getVisibleCells(),x=>(d(),_(a(ue),{key:x.id},{default:t(()=>[e(a(me),{render:x.column.columnDef.cell,props:x.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(d(),_(a(X),{key:1},{default:t(()=>[e(a(ue),{colspan:w.columns.length,class:"h-24 text-center"},{default:t(()=>[m(" No results. ")]),_:1},8,["colspan"])]),_:1}))]}),_:1})]),_:1})])),e(ia,{table:a(V)},null,8,["table"])])}}}),L=j({__name:"DataTableColumnHeader",props:{column:{},title:{}},setup(c){return(n,l)=>{const s=B("VIcon");return n.column.getCanSort()?(d(),v("div",{key:0,class:q(a(We)("flex items-center space-x-2",n.$attrs.class??""))},[e(a(he),null,{default:t(()=>[e(a(_e),{"as-child":""},{default:t(()=>[e(a(k),{variant:"ghost",size:"sm",class:"-ml-3 h-8 data-[state=open]:bg-accent"},{default:t(()=>[i("span",null,R(n.title),1),n.column.getIsSorted()==="desc"?(d(),_(s,{key:0,name:"fa-arrow-down",class:"ml-2 h-4 w-4"})):n.column.getIsSorted()==="asc"?(d(),_(s,{key:1,name:"fa-arrow-up",class:"ml-2 h-4 w-4"})):(d(),_(s,{key:2,name:"fa-sort",class:"ml-2 h-4 w-4"}))]),_:1})]),_:1}),e(a(ge),{align:"start"},{default:t(()=>[e(a(Y),{onClick:l[0]||(l[0]=r=>n.column.toggleSorting(!1))},{default:t(()=>[e(s,{name:"fa-arrow-up",class:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),m(" Asc ")]),_:1}),e(a(Y),{onClick:l[1]||(l[1]=r=>n.column.toggleSorting(!0))},{default:t(()=>[e(s,{name:"fa-arrow-down",class:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),m(" Desc ")]),_:1}),e(a(fe)),e(a(Y),{onClick:l[2]||(l[2]=r=>n.column.toggleVisibility(!1))},{default:t(()=>[e(s,{name:"fa-regular-eye-slash",class:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),m(" Hide ")]),_:1})]),_:1})]),_:1})],2)):(d(),v("div",{key:1,class:q(n.$attrs.class)},R(n.title),3))}}}),Ta=A.object({id:A.number(),name:A.string(),whatsapp_phone_number:A.string(),email:A.string().optional(),country_name:A.string(),outstanding_debts:A.number()}),ja={class:"grid gap-4 py-4"},Da={class:"grid grid-cols-4 items-center gap-4"},Ma=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),za={class:"grid grid-cols-4 items-center gap-4"},Na=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),Aa={class:"grid grid-cols-4 items-center gap-4"},Ba=i("span",{class:"absolute translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 text-red-500 rounded-full"},"*",-1),Ea={class:"col-span-3"},Wa={class:"grid grid-cols-4 items-center gap-4"},Ha={class:"grid grid-cols-4 items-center gap-4"},Ga={class:"grid grid-cols-4 items-center gap-4"},La={class:"grid grid-cols-4 items-center gap-4"},Ka={class:"grid grid-cols-4 items-center gap-4"},qa={class:"grid grid-cols-4 items-center gap-4"},Qa=j({__name:"DataTableEditModal",props:{row:{}},setup(c){const n=Q("tableStore",H("customer")),l=c,s=E({name:"",business_registration_id:"",whatsapp_phone_number:"",email:"",streetAddress:"",postcode:"",city:"",state:"",country:0}),r=E({is_loading:!1,is_open:!1,data:[{value:"",label:""}]}),p=I(!0),g=I(!1),P=I(null),{toast:T}=ee(),V=I("");async function w(b,o){r.is_loading=!0;try{var S=`/api/country/list?search=${b}`;o&&(S+=`&current_country=${o}`);const G=await N.get(S,{withCredentials:!0,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}});r.data=G.data.Result}catch(G){var f=G.response.data.message||"";T({title:"Whoops, something went wrong",description:f,variant:"destructive"})}finally{r.is_loading=!1}}ae(V,ce.debounce(async b=>{await w(b,s.country)},300));async function D(){try{const b=await N.get(`/api/customer/${l.row.id}/`);Object.assign(s,b.data.Result),s.country&&await w("",s.country),p.value=!1}catch{p.value=!1}}function U(){const b=[{condition:s.name==="",message:"Name cannot be blank"},{condition:s.whatsapp_phone_number==="",message:"Whatsapp Phone cannot be blank"},{condition:s.country==null,message:"Country cannot be blank"}];for(let o of b)if(o.condition)return P.value=o.message,!1;return!0}async function h(){if(U()){p.value=!0;try{const o=await N.patch(`/api/customer/${l.row.id}/`,{...s},{headers:{"Content-Type":"application/json"}});y(),await n.refresh(n.page_index),T({title:o.data.Result,variant:"success"})}catch{T({title:"Whoops, something went wrong",description:"An unexpected error occurred.",variant:"destructive"})}finally{p.value=!1}}}function y(){g.value=!g.value,g.value&&D()}function x(b){s.country=b.id,r.is_open=!1}function u(b){V.value=b.target.value}return(b,o)=>{const S=B("VIcon");return d(),v("div",null,[i("div",null,[e(a(k),{variant:"default",size:"sm",class:"h-8 ml-2 flex",onClick:y},{default:t(()=>[e(S,{name:"fa-pen",class:"size-4"})]),_:1})]),e(a(we),{open:g.value,"onUpdate:open":o[10]||(o[10]=f=>g.value=f)},{default:t(()=>[e(a($e),{isSideBar:!1,class:"sm:max-w-[700px]"},{default:t(()=>[e(a(be),null,{default:t(()=>[e(a(ye),null,{default:t(()=>[m("Edit Custsomer")]),_:1}),e(a(ve),null,{default:t(()=>[m(" Insert the details of the customer here. Click edit when you're done. ")]),_:1})]),_:1}),i("div",null,[i("div",ja,[i("div",Da,[e(a($),{for:"name",class:"text-right"},{default:t(()=>[m(" Company Name "),Ma]),_:1}),e(a(C),{id:"name",modelValue:s.name,"onUpdate:modelValue":o[0]||(o[0]=f=>s.name=f),placeholder:"Geroge Sdn Bhd",class:"col-span-3"},null,8,["modelValue"])]),i("div",za,[e(a($),{for:"whatsapp_phone",class:"text-right required:"},{default:t(()=>[m(" Whatsapp Phone "),Na]),_:1}),e(a(C),{id:"whatsapp_phone",modelValue:s.whatsapp_phone_number,"onUpdate:modelValue":o[1]||(o[1]=f=>s.whatsapp_phone_number=f),placeholder:"0129876348",class:"col-span-3"},null,8,["modelValue"])]),i("div",Aa,[e(a($),{for:"country",class:"text-right leading-normal"},{default:t(()=>[m(" Country "),Ba]),_:1}),i("div",Ea,[e(a(te),{open:r.is_open,"onUpdate:open":o[3]||(o[3]=f=>r.is_open=f)},{default:t(()=>[e(a(se),{"as-child":""},{default:t(()=>[e(a(k),{variant:"outline",role:"combobox","aria-expanded":r.is_open,class:"w-full justify-between px-3",disabled:r.is_loading},{default:t(()=>{var f;return[m(R(s.country?(f=r.data.find(G=>G.id===s.country))==null?void 0:f.label:"Select country")+" ",1),r.is_loading?(d(),_(S,{key:0,name:"fa-circle-notch",animation:"spin",class:"w-4 h-4 mr-2"})):(d(),_(S,{key:1,name:"fa-angle-down",class:"h-4 w-4 shrink-0 opacity-50"}))]}),_:1},8,["aria-expanded","disabled"])]),_:1}),e(a(le),{class:"w-[500px] p-1"},{default:t(()=>[e(a(ne),null,{default:t(()=>[e(a(oe),{class:"h-9",modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=f=>V.value=f),placeholder:"Search country...",onInput:u},null,8,["modelValue"]),e(a(ie),null,{default:t(()=>[m("No country found.")]),_:1}),r.is_loading?(d(),_(a(K),{key:1},{default:t(()=>[e(S,{name:"fa-circle-notch",animation:"spin",speed:"slow",class:"w-fit h-fit mr-2 my-2 mx-auto"})]),_:1})):(d(),_(a(K),{key:0},{default:t(()=>[e(a(re),null,{default:t(()=>[(d(!0),v(M,null,z(r.data,f=>(d(),_(a(de),{key:f.id,value:f.value??"",onSelect:()=>x(f)},{default:t(()=>[m(R(f.label)+" ",1),e(S,{name:"fa-check",class:q(["ml-auto h-4 w-4",s.country===f.id?"opacity-100":"opacity-0"])},null,8,["class"])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["open"])])]),i("div",Wa,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Email ")]),_:1}),e(a(C),{id:"email",modelValue:s.email,"onUpdate:modelValue":o[4]||(o[4]=f=>s.email=f),placeholder:"hello@example.com",class:"col-span-3"},null,8,["modelValue"])]),i("div",Ha,[e(a($),{for:"business_registration_id",class:"text-right"},{default:t(()=>[m(" Business ID ")]),_:1}),e(a(C),{id:"business_registration_id",modelValue:s.business_registration_id,"onUpdate:modelValue":o[5]||(o[5]=f=>s.business_registration_id=f),placeholder:"820720-X",class:"col-span-3"},null,8,["modelValue"])]),e(O),i("div",Ga,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Address ")]),_:1}),e(a(C),{id:"email",modelValue:s.streetAddress,"onUpdate:modelValue":o[6]||(o[6]=f=>s.streetAddress=f),placeholder:"Lot 2000, Taman Jalan Indah",class:"col-span-3"},null,8,["modelValue"])]),i("div",La,[e(a($),{for:"state",class:"text-right leading-normal"},{default:t(()=>[m(" State ")]),_:1}),e(a(C),{id:"state",modelValue:s.state,"onUpdate:modelValue":o[7]||(o[7]=f=>s.state=f),placeholder:"Selangor",class:"col-span-3"},null,8,["modelValue"])]),i("div",Ka,[e(a($),{for:"city",class:"text-right leading-normal"},{default:t(()=>[m(" City ")]),_:1}),e(a(C),{id:"city",modelValue:s.city,"onUpdate:modelValue":o[8]||(o[8]=f=>s.city=f),placeholder:"Puchong",class:"col-span-3"},null,8,["modelValue"])]),i("div",qa,[e(a($),{for:"email",class:"text-right leading-normal"},{default:t(()=>[m(" Post Code ")]),_:1}),e(a(C),{id:"email",modelValue:s.postcode,"onUpdate:modelValue":o[9]||(o[9]=f=>s.postcode=f),placeholder:"22000",class:"col-span-3"},null,8,["modelValue"])])])]),e(a(Ve),{class:"flex justify-end"},{default:t(()=>[e(a(k),{type:"submit",onClick:h,disabled:p.value},{default:t(()=>[p.value?(d(),_(S,{key:0,name:"fa-circle-notch",animation:"spin",speed:"slow",class:"w-fit h-fit mr-2"})):W("",!0),m(" Edit")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Ja={class:"flex gap-1"},Oa=j({__name:"DataTableRowActions",props:{row:{}},setup(c){const n=c;console.log(n.row);const l=Z(()=>Ta.parse(n.row.original));return(s,r)=>(d(),v("div",Ja,[e(Qa,{row:l.value},null,8,["row"])]))}}),Xa=[{id:"select",header:({table:c})=>F(pe,{checked:c.getIsAllPageRowsSelected()||c.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:checked":n=>c.toggleAllPageRowsSelected(!!n),ariaLabel:"Select all",class:"translate-y-0.5"}),cell:({row:c})=>F(pe,{checked:c.getIsSelected(),"onUpdate:checked":n=>c.toggleSelected(!!n),ariaLabel:"Select row",class:"translate-y-0.5"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:c})=>F(L,{column:c,title:"Name"}),cell:({row:c})=>{const n=c.original.id,l=c.getValue("name");return F(He,{class:"w-fit underline cursor-pointer font-bold",to:`/customer/${n}`},()=>l)},enableSorting:!1,enableHiding:!1,filterFn:(c,n,l)=>{var p;const s=((p=c.getValue(n))==null?void 0:p.toString().toLowerCase())??"",r=l==null?void 0:l.toString().toLowerCase();return s.includes(r)}},{accessorKey:"email",header:({column:c})=>F(L,{column:c,title:"Email"}),cell:({row:c})=>F("div",{class:"w-fit"},c.getValue("email")),enableSorting:!1,enableHiding:!1,meta:{title:"Email"}},{accessorKey:"whatsapp_phone_number",header:({column:c})=>F(L,{column:c,title:"Whatsapp Phone"}),cell:({row:c})=>F("div",{class:"w-fit"},c.getValue("whatsapp_phone_number")),enableSorting:!1,enableHiding:!1,meta:{title:"Whatsapp Phone"}},{accessorKey:"country_name",header:({column:c})=>F(L,{column:c,title:"Country"}),cell:({row:c})=>F("div",{class:"w-fit"},c.getValue("country_name")),enableSorting:!1,enableHiding:!1,meta:{title:"Company Name"}},{accessorKey:"outstanding_debts",header:({column:c})=>F(L,{column:c,title:"Outstanding Debts"}),cell:({row:c})=>{const n=c.getValue("outstanding_debts");return F(Qe,{variant:n===0||n===0?"success":"destructive"},`${n} MYR`)},enableSorting:!0,enableHiding:!0,meta:{title:"Outstanding Debt"}},{id:"actions",cell:({row:c})=>F(Oa,{row:c})}],Ya={class:"border border-secondary rounded"},Za={class:"bg-border/20 p-4"},et={class:"flex flex-col gap-4"},at={class:"flex flex-col md:flex-row gap-x-2 md:justify-items-center md:items-center mx-auto w-full"},tt={class:"flex flex-col md:flex-row gap-x-2 md:justify-items-center md:items-center mx-auto w-full"},st={class:"flex flex-col w-full"},lt=i("p",{class:"text-center text-lg font-bold mb-2"},"General Settings",-1),nt={class:"flex flex-row justify-center w-full"},ot=i("div",{class:"text-left lg:text-right my-auto mr-4"},[i("p",{class:"mr-3"},"Default Country")],-1),it={class:"flex self-end justify-end justify-self-end space-x-2"},rt="/api/customer/settings",dt=j({__name:"GeneralSettingCard",setup(c){const n=Q("tableStore",H("customer")),l=E({default_country:null}),s=E({is_loading:!1,is_open:!1,data:[{value:"",label:""}]}),r=I(!1),p=I(!1),{toast:g}=ee(),P=I("");async function T(h){s.is_loading=!0;try{const y=await N.get(`/api/country/list?search=${h||""}`,{withCredentials:!0,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}});s.data=y.data.Result}catch{g({title:"Whoops, something went wrong",description:"There was an error fetching the country list",variant:"destructive"})}finally{s.is_loading=!1}}ae(P,ce.debounce(async h=>{await T(h)},500));const V=async()=>{try{const h=await N.get(rt);Object.assign(l,h.data.Result)}catch{g({title:"Whoops, something went wrong",description:"Fail to load the general settings",variant:"destructive"})}},w=async()=>{p.value=!0;try{const h=await N.post("/api/bukku/refresh-contact",{...l},{headers:{"Content-Type":"application/json"}});n.refresh(n.page_index),g({title:h.data.Result,variant:"success"})}catch{g({title:"Whoops, something went wrong",description:"An unexpected error occurred.",variant:"destructive"})}finally{p.value=!1}},D=async()=>{r.value=!0;try{const h=await N.patch("/api/customer/settings",{...l},{headers:{"Content-Type":"application/json"}});g({title:h.data.Result,variant:"success"})}catch{g({title:"Whoops, something went wrong",description:"An unexpected error occurred.",variant:"destructive"})}finally{r.value=!1}};xe(async()=>{await V(),T()});function U(h){h.id==l.default_country?l.default_country=null:l.default_country=h.id,s.is_open=!1}return(h,y)=>{const x=B("VIcon");return d(),v("div",Ya,[i("div",Za,[i("div",et,[i("div",at,[e(a(k),{onClick:w,class:"mx-auto w-[200px]",disabled:p.value},{default:t(()=>[m("Refresh Customer "),e(x,{name:"md-refresh",class:"ml-2 h-4 w-4",animation:p.value?"spin":""},null,8,["animation"])]),_:1},8,["disabled"])]),e(a(O),{class:"my-1"}),i("div",tt,[i("div",st,[lt,i("div",nt,[ot,e(a(te),{class:"col-span-2",open:s.is_open,"onUpdate:open":y[1]||(y[1]=u=>s.is_open=u)},{default:t(()=>[e(a(se),{"as-child":""},{default:t(()=>[e(a(k),{variant:"outline",role:"combobox","aria-expanded":s.is_open,class:"w-full lg:w-1/3 justify-between px-3",disabled:s.is_loading},{default:t(()=>{var u;return[m(R(l.default_country?(u=s.data.find(b=>b.id===l.default_country))==null?void 0:u.label:"Select country")+" ",1),s.is_loading?(d(),_(x,{key:0,name:"fa-circle-notch",animation:"spin",class:"w-4 h-4 mr-2"})):(d(),_(x,{key:1,name:"fa-angle-down",class:"h-4 w-4 shrink-0 opacity-50"}))]}),_:1},8,["aria-expanded","disabled"])]),_:1}),e(a(le),{class:"md:w-[500px] p-1"},{default:t(()=>[e(a(ne),null,{default:t(()=>[e(a(oe),{class:"h-9",modelValue:P.value,"onUpdate:modelValue":y[0]||(y[0]=u=>P.value=u),placeholder:"Search country..."},null,8,["modelValue"]),e(a(ie),null,{default:t(()=>[m("No country found.")]),_:1}),e(a(K),null,{default:t(()=>[e(a(re),null,{default:t(()=>[(d(!0),v(M,null,z(s.data,u=>(d(),_(a(de),{key:u.id,value:u.value??"",onSelect:()=>U(u)},{default:t(()=>[m(R(u.label)+" ",1),e(x,{name:"fa-check",class:q(["ml-auto h-4 w-4",l.default_country===u.id?"opacity-100":"opacity-0"])},null,8,["class"])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])])]),i("div",it,[e(a(k),{onClick:D,class:"w-[100px]",disabled:r.value},{default:t(()=>[m(" Save ")]),_:1},8,["disabled"])])])])])}}}),ct={class:"p-4 md:p-8 space-y-8 h-full"},ut=i("div",{class:"flex items-center justify-between space-y-2"},[i("div",null,[i("h2",{class:"text-2xl font-bold tracking-tight"},"Customer"),i("p",{class:"text-muted-foreground"},"Here's a list of your existing customers!")])],-1),mt="/api/customer",xt=j({__name:"Customer",setup(c){const n=H("customer"),l=Je("bukku"),s=r=>({id:r.id,name:r.name,whatsapp_phone_number:r.whatsapp_phone_number||"",email:r.email||"",country_name:r.country_name,outstanding_debts:r.outstanding_debts});return xe(async()=>{await n.fetch(mt,0,s),l.init("/api/connections/bukku")}),Le("tableStore",n),Ge(()=>{n.$reset()}),(r,p)=>(d(),v("div",ct,[ut,a(l).is_authenticated?(d(),_(dt,{key:0})):W("",!0),e(Fa,{data:a(n).tasks,columns:a(Xa)},null,8,["data","columns"])]))}});export{xt as default};
